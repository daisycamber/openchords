!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Midi=e():t.Midi=e()}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){var n,i,a;i=[e,r(2),r(1)],void 0===(a="function"==typeof(n=function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;var i=new WeakMap,a=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i.set(this,480),this.tempos=[],this.timeSignatures=[],this.name="",this.meta=[],e&&(i.set(this,e.header.ticksPerBeat),e.tracks[0].forEach(function(t){t.meta&&("timeSignature"===t.type?r.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?r.tempos.push({ticks:t.absoluteTime,bpm:6e7/t.microsecondsPerBeat}):"trackName"===t.type?r.name=t.text:"endOfTrack"!==t.type&&r.meta.push({type:t.type,text:t.text,ticks:t.absoluteTime}))}),this.update())}return r=t,(a=[{key:"update",value:function(){var t=this,e=0,r=0;this.tempos.sort(function(t,e){return t.ticks-e.ticks}),this.tempos.forEach(function(n,i){var a=i>0?t.tempos[i-1].bpm:t.tempos[0].bpm,o=n.ticks/t.ppq-r,s=60/a*o;n.time=s+e,e=n.time,r+=o}),this.timeSignatures.sort(function(t,e){return t.ticks-e.ticks}),this.timeSignatures.forEach(function(e,r){var n=r>0?t.timeSignatures[r-1]:t.timeSignatures[0],i=(e.ticks-n.ticks)/t.ppq,a=i/n.timeSignature[0]/(n.timeSignature[1]/4);n.measures=n.measures||0,e.measures=a+n.measures})}},{key:"ticksToSeconds",value:function(t){var r=(0,e.search)(this.tempos,t);if(-1!==r){var n=this.tempos[r],i=n.time,a=(t-n.ticks)/this.ppq;return i+60/n.bpm*a}var o=t/this.ppq;return.5*o}},{key:"ticksToMeasures",value:function(t){var r=(0,e.search)(this.timeSignatures,t);if(-1!==r){var n=this.timeSignatures[r],i=(t-n.ticks)/this.ppq;return n.measures+i/(n.timeSignature[0]/n.timeSignature[1])/4}return t/this.ppq/4}},{key:"secondsToTicks",value:function(t){var r=(0,e.search)(this.tempos,t,"time");if(-1!==r){var n=this.tempos[r],i=n.time,a=t-i,o=a/(60/n.bpm);return Math.round(n.ticks+o*this.ppq)}var s=t/.5;return Math.round(s*this.ppq)}},{key:"toJSON",value:function(){return{name:this.name,ppq:this.ppq,meta:this.meta,tempos:this.tempos.map(function(t){return{ticks:t.ticks,bpm:t.bpm}}),timeSignatures:this.timeSignatures}}},{key:"fromJSON",value:function(t){this.name=t.name,this.tempos=t.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=t.timeSignatures.map(function(t){return Object.assign({},t)}),this.meta=t.meta.map(function(t){return Object.assign({},t)}),i.set(this,t.ppq),this.update()}},{key:"ppq",get:function(){return i.get(this)}}])&&n(r.prototype,a),o&&n(r,o),t;var r,a,o}();t.Header=a})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e,r(3),r(0),r(4),r(12)],void 0===(a="function"==typeof(n=function(t,e,r,n,i){"use strict";function a(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}Object.defineProperty(t,"__esModule",{value:!0}),t.Midi=void 0;var c=function(){function t(i){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var o=null;i&&(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),(o=(0,e.parseMidi)(i)).tracks.forEach(function(t){var e=0;t.forEach(function(t){e+=t.deltaTime,t.absoluteTime=e})})),this.header=new r.Header(o),this.tracks=[],i&&(this.tracks=o.tracks.map(function(t){return new n.Track(t,a.header)}),1===o.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return s(t,null,[{key:"fromUrl",value:function(e){return fetch(e).then(function(t){if(t.ok)return t.arrayBuffer();throw new Error("could not load ".concat(e))}).then(function(e){return new t(e)})}}]),s(t,[{key:"addTrack",value:function(){var t=new n.Track(void 0,this.header);return this.tracks.push(t),t}},{key:"toArray",value:function(){return(0,i.encode)(this)}},{key:"toJSON",value:function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(t){return t.toJSON()})}}},{key:"fromJSON",value:function(t){var e=this;this.header=new r.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map(function(t){var r=new n.Track(void 0,e.header);return r.fromJSON(t),r})}},{key:"clone",value:function(){var e=new t;return e.fromJSON(this.toJSON()),e}},{key:"name",get:function(){return this.header.name},set:function(t){this.header.name=t}},{key:"duration",get:function(){var t=this.tracks.map(function(t){return t.duration});return Math.max.apply(Math,a(t))}},{key:"durationTicks",get:function(){var t=this.tracks.map(function(t){return t.durationTicks});return Math.max.apply(Math,a(t))}}]),t}();t.Midi=c})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e],void 0===(a="function"==typeof(n=function(t){"use strict";function e(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ticks",n=0,i=t.length,a=i;if(i>0&&t[i-1][r]<=e)return i-1;for(;n<a;){var o=Math.floor(n+(a-n)/2),s=t[o],c=t[o+1];if(s[r]===e){for(var u=o;u<t.length;u++){var f=t[u];f[r]===e&&(o=u)}return o}if(s[r]<e&&c[r]>e)return o;s[r]>e?a=o:s[r]<e&&(n=o+1)}return-1}Object.defineProperty(t,"__esModule",{value:!0}),t.insert=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ticks";if(t.length){var i=e(t,r[n],n);t.splice(i+1,0,r)}else t.push(r)},t.search=e})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){e.parseMidi=r(6),e.writeMidi=r(7)},function(t,e,r){var n,i,a;i=[e,r(8),r(5),r(2),r(9),r(11),r(0)],void 0===(a="function"==typeof(n=function(t,e,r,n,i,a,o){"use strict";function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Track=void 0;var c=new WeakMap,u=function(){function t(e,r){var n=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c.set(this,r),this.name="",e){var o=e.find(function(t){return"trackName"===t.type});this.name=o?o.text:""}if(this.instrument=new i.Instrument(e,this),this.notes=[],this.channel=0,this.controlChanges=(0,a.ControlChanges)(),e){for(var s=e.filter(function(t){return"noteOn"===t.type}),u=e.filter(function(t){return"noteOff"===t.type}),f=function(){var t=s.shift(),e=u.findIndex(function(e){return e.noteNumber===t.noteNumber});if(-1!==e){var r=u.splice(e,1)[0];n.addNote({midi:t.noteNumber,ticks:t.absoluteTime,velocity:t.velocity/127,durationTicks:r.absoluteTime-t.absoluteTime,noteOffVelocity:r.velocity/127})}};s.length;)f();var h=e.filter(function(t){return"controller"===t.type});h.forEach(function(t){n.addCC({number:t.controllerType,value:t.value/127,ticks:t.absoluteTime})})}}return o=t,(u=[{key:"addNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=c.get(this),i=new e.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(i,t),(0,n.insert)(this.notes,i,"ticks"),this}},{key:"addCC",value:function(t){var e=c.get(this),i=new r.ControlChange({controllerType:t.number},e);return delete t.number,Object.assign(i,t),Array.isArray(this.controlChanges[i.number])||(this.controlChanges[i.number]=[]),(0,n.insert)(this.controlChanges[i.number],i,"ticks"),this}},{key:"fromJSON",value:function(t){var e=this;for(var r in this.name=t.name,this.channel=t.channel,this.instrument=new i.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.controlChanges)t.controlChanges[r].forEach(function(t){e.addCC({number:t.number,value:t.value,ticks:t.ticks})});t.notes.forEach(function(t){e.addNote({ticks:t.ticks,durationTicks:t.durationTicks,velocity:t.velocity,midi:t.midi})})}},{key:"toJSON",value:function(){for(var t={},e=0;e<127;e++)this.controlChanges.hasOwnProperty(e)&&(t[e]=this.controlChanges[e].map(function(t){return t.toJSON()}));return{name:this.name,channel:this.channel,instrument:this.instrument.toJSON(),notes:this.notes.map(function(t){return t.toJSON()}),controlChanges:t}}},{key:"duration",get:function(){var t=this.notes[this.notes.length-1];return t?t.time+t.duration:0}},{key:"durationTicks",get:function(){var t=this.notes[this.notes.length-1];return t?t.ticks+t.durationTicks:0}}])&&s(o.prototype,u),f&&s(o,f),t;var o,u,f}();t.Track=u})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e,r(0)],void 0===(a="function"==typeof(n=function(t,e){"use strict";function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0;var n={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"};t.controlChangeNames=n;var i=Object.keys(n).reduce(function(t,e){return t[n[e]]=e,t},{});t.controlChangeIds=i;var a=new WeakMap,o=new WeakMap,s=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a.set(this,r),o.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return e=t,(i=[{key:"toJSON",value:function(){return{number:this.number,value:this.value,time:this.time,ticks:this.ticks}}},{key:"number",get:function(){return o.get(this)}},{key:"name",get:function(){return n[this.number]?n[this.number]:null}},{key:"time",get:function(){var t=a.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var e=a.get(this);this.ticks=e.secondsToTicks(t)}}])&&r(e.prototype,i),s&&r(e,s),t;var e,i,s}();t.ControlChange=s})?n.apply(e,i):n)||(t.exports=a)},function(t,e){function r(t){for(var e,r=new n(t),i=[];!r.eof();){var a=o();i.push(a)}return i;function o(){var t={};t.deltaTime=r.readVarInt();var n=r.readUInt8();if(240==(240&n)){if(255!==n){if(240==n){t.type="sysEx";a=r.readVarInt();return t.data=r.readBytes(a),t}if(247==n){t.type="endSysEx";a=r.readVarInt();return t.data=r.readBytes(a),t}throw"Unrecognised MIDI event type byte: "+n}t.meta=!0;var i=r.readUInt8(),a=r.readVarInt();switch(i){case 0:if(t.type="sequenceNumber",2!==a)throw"Expected length for sequenceNumber event is 2, got "+a;return t.number=stream.readUInt16(),t;case 1:return t.type="text",t.text=r.readString(a),t;case 2:return t.type="copyrightNotice",t.text=r.readString(a),t;case 3:return t.type="trackName",t.text=r.readString(a),t;case 4:return t.type="instrumentName",t.text=r.readString(a),t;case 5:return t.type="lyrics",t.text=r.readString(a),t;case 6:return t.type="marker",t.text=r.readString(a),t;case 7:return t.type="cuePoint",t.text=r.readString(a),t;case 32:if(t.type="channelPrefix",1!=a)throw"Expected length for channelPrefix event is 1, got "+a;return t.channel=r.readUInt8(),t;case 33:if(t.type="portPrefix",1!=a)throw"Expected length for portPrefix event is 1, got "+a;return t.port=r.readUInt8(),t;case 47:if(t.type="endOfTrack",0!=a)throw"Expected length for endOfTrack event is 0, got "+a;return t;case 81:if(t.type="setTempo",3!=a)throw"Expected length for setTempo event is 3, got "+a;return t.microsecondsPerBeat=r.readUInt24(),t;case 84:if(t.type="smpteOffset",5!=a)throw"Expected length for smpteOffset event is 5, got "+a;var o=r.readUInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&o],t.hour=31&o,t.min=r.readUInt8(),t.sec=r.readUInt8(),t.frame=r.readUInt8(),t.subFrame=r.readUInt8(),t;case 88:if(t.type="timeSignature",4!=a)throw"Expected length for timeSignature event is 4, got "+a;return t.numerator=r.readUInt8(),t.denominator=1<<r.readUInt8(),t.metronome=r.readUInt8(),t.thirtyseconds=r.readUInt8(),t;case 89:if(t.type="keySignature",2!=a)throw"Expected length for keySignature event is 2, got "+a;return t.key=r.readInt8(),t.scale=r.readUInt8(),t;case 127:return t.type="sequencerSpecific",t.data=r.readBytes(a),t;default:return t.type="unknownMeta",t.data=r.readBytes(a),t.metatypeByte=i,t}}else{var s;if(0==(128&n)){if(null===e)throw"Running status byte encountered before status byte";s=n,n=e,t.running=!0}else s=r.readUInt8(),e=n;var c=n>>4;switch(t.channel=15&n,c){case 8:return t.type="noteOff",t.noteNumber=s,t.velocity=r.readUInt8(),t;case 9:var u=r.readUInt8();return t.type=0===u?"noteOff":"noteOn",t.noteNumber=s,t.velocity=u,0===u&&(t.byte9=!0),t;case 10:return t.type="noteAftertouch",t.noteNumber=s,t.amount=r.readUInt8(),t;case 11:return t.type="controller",t.controllerType=s,t.value=r.readUInt8(),t;case 12:return t.type="programChange",t.programNumber=s,t;case 13:return t.type="channelAftertouch",t.amount=s,t;case 14:return t.type="pitchBend",t.value=s+(r.readUInt8()<<7)-8192,t;default:throw"Unrecognised MIDI event type: "+c}}}}function n(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}n.prototype.eof=function(){return this.pos>=this.bufferLen},n.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},n.prototype.readInt8=function(){var t=this.readUInt8();return 128&t?t-256:t},n.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt16=function(){var t=this.readUInt16();return 32768&t?t-65536:t},n.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt24=function(){var t=this.readUInt24();return 8388608&t?t-16777216:t},n.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},n.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)},n.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(!(128&e))return t+e;t+=127&e,t<<=7}return t},n.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32();return{id:t,length:e,data:this.readBytes(e)}},t.exports=function(t){var e=new n(t),i=e.readChunk();if("MThd"!=i.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+i.id+"'";for(var a=function(t){var e=new n(t),r=e.readUInt16(),i=e.readUInt16(),a={format:r,numTracks:i},o=e.readUInt16();return 32768&o?(a.framesPerSecond=256-(o>>8),a.ticksPerFrame=255&o):a.ticksPerBeat=o,a}(i.data),o=[],s=0;!e.eof()&&s<a.numTracks;s++){var c=e.readChunk();if("MTrk"!=c.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var u=r(c.data);o.push(u)}return{header:a,tracks:o}}},function(t,e){function r(t,e,r){var a,o=new i,s=e.length,c=null;for(a=0;a<s;a++)!1!==r.running&&(r.running||e[a].running)||(c=null),c=n(o,e[a],c,r.useByte9ForNoteOff);t.writeChunk("MTrk",o.buffer)}function n(t,e,r,n){var i=e.type,a=e.deltaTime,o=e.text||"",s=e.data||[],c=null;switch(t.writeVarInt(a),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var u=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(u),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var f=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(f),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(s.length),t.writeBytes(s);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(s.length),t.writeBytes(s));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(s.length),t.writeBytes(s);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(s.length),t.writeBytes(s);break;case"noteOff":(c=(!1!==n&&e.byte9||n&&0==e.velocity?144:128)|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(c=144|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(c=160|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(c=176|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(c=192|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(c=208|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.amount);break;case"pitchBend":(c=224|e.channel)!==r&&t.writeUInt8(c);var h=8192+e.value,l=127&h,p=h>>7&127;t.writeUInt8(l),t.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return c}function i(){this.buffer=[]}i.prototype.writeUInt8=function(t){this.buffer.push(255&t)},i.prototype.writeInt8=i.prototype.writeUInt8,i.prototype.writeUInt16=function(t){var e=t>>8&255,r=255&t;this.writeUInt8(e),this.writeUInt8(r)},i.prototype.writeInt16=i.prototype.writeUInt16,i.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n)},i.prototype.writeInt24=i.prototype.writeUInt24,i.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,n=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n),this.writeUInt8(i)},i.prototype.writeInt32=i.prototype.writeUInt32,i.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},i.prototype.writeString=function(t){var e,r=t.length,n=[];for(e=0;e<r;e++)n.push(t.codePointAt(e));this.writeBytes(n)},i.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(127&e),e>>=7;e;){var n=127&e|128;r.push(n),e>>=7}this.writeBytes(r.reverse())}},i.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=function(t,e){if("object"!=typeof t)throw"Invalid MIDI data";e=e||{};var n,a=t.header||{},o=t.tracks||[],s=o.length,c=new i;for(function(t,e,r){var n=null==e.format?1:e.format,a=128;e.timeDivision?a=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?a=-(255&e.framesPerSecond)<<8|255&ticksPerFrame:e.ticksPerBeat&&(a=32767&e.ticksPerBeat);var o=new i;o.writeUInt16(n),o.writeUInt16(r),o.writeUInt16(a),t.writeChunk("MThd",o.buffer)}(c,a,s),n=0;n<s;n++)r(c,o[n],e);return c.buffer}},function(t,e,r){var n,i,a;i=[e,r(0),r(2)],void 0===(a="function"==typeof(n=function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t){var e=t%12;return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e]}Object.defineProperty(t,"__esModule",{value:!0}),t.Note=void 0;var a,o,s=(a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(t){var e=a.exec(t),r=e[1],n=e[2],i=o[r.toLowerCase()];return i+12*(parseInt(n)+1)}),c=new WeakMap,u=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=r.velocity,this.ticks=e.ticks,this.durationTicks=r.ticks-e.ticks}return e=t,(r=[{key:"toJSON",value:function(){return{time:this.time,midi:this.midi,name:this.name,velocity:this.velocity,duration:this.duration,ticks:this.ticks,durationTicks:this.durationTicks}}},{key:"name",get:function(){return t=this.midi,e=Math.floor(t/12)-1,i(t)+e.toString();var t,e},set:function(t){this.midi=s(t)}},{key:"octave",get:function(){return Math.floor(this.midi/12)-1},set:function(t){var e=t-this.octave;this.midi+=12*e}},{key:"pitch",get:function(){return i(this.midi)},set:function(t){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)}},{key:"duration",get:function(){var t=c.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var e=c.get(this),r=e.secondsToTicks(this.time+t);this.durationTicks=r-this.ticks}},{key:"time",get:function(){var t=c.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var e=c.get(this);this.ticks=e.secondsToTicks(t)}},{key:"bars",get:function(){var t=c.get(this);return t.ticksToMeasures(this.ticks)}}])&&n(e.prototype,r),a&&n(e,a),t;var e,r,a}();t.Note=u})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e,r(10),r(4)],void 0===(a="function"==typeof(n=function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Instrument=void 0;var i=new WeakMap,a=function(){function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i.set(this,r),this.number=0,e){var n=e.find(function(t){return"programChange"===t.type});n&&(this.number=n.programNumber)}}return r=t,(a=[{key:"toJSON",value:function(){return{number:this.number,name:this.name,family:this.family}}},{key:"fromJSON",value:function(t){this.number=t.number}},{key:"name",get:function(){return this.percussion?e.drumKitByPatchID[this.number]:e.instrumentByPatchID[this.number]},set:function(t){var r=e.instrumentByPatchID.indexOf(t);-1!==r&&(this.number=r)}},{key:"family",get:function(){return this.percussion?"drums":e.instrumentFamilyByID[Math.floor(this.number/8)]}},{key:"percussion",get:function(){var t=i.get(this);return[9,10].includes(t.channel)}}])&&n(r.prototype,a),o&&n(r,o),t;var r,a,o}();t.Instrument=a})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e],void 0===(a="function"==typeof(n=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drumKitByPatchID=t.instrumentFamilyByID=t.instrumentByPatchID=void 0,t.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],t.instrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],t.drumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e,r(5)],void 0===(a="function"==typeof(n=function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChanges=function(){return new Proxy({},{get:function(t,r){return t[r]?t[r]:e.controlChangeIds.hasOwnProperty(r)?t[e.controlChangeIds[r]]:void 0},set:function(t,r,n){return e.controlChangeIds.hasOwnProperty(r)?t[e.controlChangeIds[r]]=n:t[r]=n,!0}})}})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){var n,i,a;i=[e,r(3),r(13),r(1)],void 0===(a="function"==typeof(n=function(t,e,r,n){"use strict";function i(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.encode=function(t){var n={header:{ticksPerBeat:t.header.ppq,format:1,numTracks:t.tracks.length+1},tracks:[[{ticks:0,meta:!0,type:"trackName",text:t.header.name}].concat(i(t.header.meta.map(function(t){return{ticks:t.ticks,meta:!0,type:t.type,text:t.text}})),i(t.header.tempos.map(function(t){return{type:"setTempo",microsecondsPerBeat:Math.floor(6e7/t.bpm),ticks:t.ticks,meta:!0}})),i(t.header.timeSignatures.map(function(t){return{type:"timeSignature",meta:!0,ticks:t.ticks,numerator:t.timeSignature[0],denominator:t.timeSignature[1],metronome:24,thirtyseconds:8}})))].concat(i(t.tracks.map(function(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&e.push(t.controlChanges[n].map(function(e){return{type:"controller",controllerType:e.number,value:Math.floor(127*e.value),channel:t.channel,ticks:e.ticks}}));return[{type:"trackName",text:t.name,meta:!0,ticks:0},{type:"programChange",ticks:0,channel:t.channel,programNumber:t.instrument.number}].concat(i((0,r.default)(t.notes.map(function(e){return[{type:"noteOn",channel:t.channel,noteNumber:e.midi,ticks:e.ticks,velocity:Math.floor(127*e.velocity)},{type:"noteOff",channel:t.channel,noteNumber:e.midi,ticks:e.ticks+e.durationTicks,velocity:Math.floor(127*e.noteOffVelocity)}]}))),i((0,r.default)(e)))})))};return n.tracks=n.tracks.map(function(t){t=t.sort(function(t,e){return t.ticks-e.ticks});var e=0;return t.forEach(function(t){t.deltaTime=t.ticks-e,e=t.ticks,delete t.ticks}),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t}),new Uint8Array((0,e.writeMidi)(n))},r=(a=r)&&a.__esModule?a:{default:a}})?n.apply(e,i):n)||(t.exports=a)},function(t,e,r){"use strict";function n(t){return function t(e,r){for(var n=0;n<e.length;n++){var i=e[n];Array.isArray(i)?t(i,r):r.push(i)}return r}(t,[])}function i(t,e){if("number"!=typeof e)throw new TypeError("Expected the depth to be a number");return function t(e,r,n){n--;for(var i=0;i<e.length;i++){var a=e[i];n>-1&&Array.isArray(a)?t(a,r,n):r.push(a)}return r}(t,[],e)}t.exports=function(t){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return n(t)},t.exports.from=n,t.exports.depth=function(t,e){if(!Array.isArray(t))throw new TypeError("Expected value to be an array");return i(t,e)},t.exports.fromDepth=i}]).Midi});
//# sourceMappingURL=Midi.js.map